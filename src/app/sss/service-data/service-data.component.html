<h5 style="text-align: center;">Данные сервисов</h5>
<p-toast></p-toast>
<p-toolbar styleClass="p-mb-2">
  <ng-template pTemplate="left">
    <button pButton pRipple label="Новые данные сервиса" icon="pi pi-plus" class="p-button-success" (click)="addService_Data()" ></button>
  </ng-template>
</p-toolbar>
<p-table
  styleClass="p-datatable-gridlines"
  [resizableColumns]="true"
  [columns]="colsService_Data"
  [value]="Service_Datas"
  sortMode="multiple"
  [scrollable]="true"
  selectionMode="single"
  [metaKeySelection]="true"
  [paginator]="true"
  [rows]="10" [pageLinks]="3" [rowsPerPageOptions]="[5,10,20,1000]"
  currentPageReportTemplate="Демонстрация от {first} до {last} из {totalRecords} записи(ей)" [showCurrentPageReport]="true"
  [(selection)]="selectItem"
  
  
>
  <ng-template pTemplate="header" let-columns let-rowData let-colum>
    <tr>
      <th pResizableColumn >
        <p-tableHeaderCheckbox> </p-tableHeaderCheckbox>
      </th>
      <th *ngFor="let col of columns" [pSortableColumn]="col.field" pResizableColumn >
        {{col.header}}
        <p-sortIcon [field]="col.field"></p-sortIcon>
      </th>
      <th pResizableColumn ></th>
    </tr>
    <tr>
      <th></th>
      <th *ngFor="let col of columns"  pResizableColumn>
        <p-columnFilter type="text" [field]="col.subfield"  [matchMode]="'contains'">
        </p-columnFilter>
      </th>
      <th pResizableColumn ></th>
    </tr>
  </ng-template>

  <ng-template pTemplate="body" let-rowData let-columns="columns"  let-colum>
    <tr [pEditableRow]="rowData" >
      <td pResizableColumn >
      <p-tableCheckbox [value]="colum"></p-tableCheckbox>
      </td>
          <td pResizableColumn>{{rowData?.service?.server?.dns_name  + ' + ' + rowData?.service?.server_description}}</td>
          <td pResizableColumn>{{rowData?.server_Partition?.server?.dns_name   + ' + ' + rowData?.server_Partition?.server_mount_point}}</td>
          <td pResizableColumn>{{rowData?.storage_Partition?.storage?.dns_name  + ' + ' + rowData?.storage_Partition?.server_mount_point }}</td>
          <td pResizableColumn>{{rowData.path}}</td>
          <td pResizableColumn>{{rowData.my_notes}}</td>
      <td pResizableColumn >
        <button pButton pRipple icon="pi pi-trash"
                class="p-button-rounded p-button-warning"
                type="button"
                (click)="deleteService_Data(rowData.service_id)">
        </button>
        <button pButton pRipple icon="pi pi-pencil"
                class="p-button-rounded p-button-help"
                type="button"
                (click)="editService_Data(rowData)">
        </button>
      </td>
    </tr>
  </ng-template>
</p-table>

<p-dialog [(visible)]="Service_DataDialog" [style]="{width: '450px'}" header="Новые данные сервиса" [modal]="true" styleClass="p-fluid" >

  <div class="dropdown">
    <label>Cервис</label>
    <ng-select  [items]="services"
                placeholder="ДНС имя сервера + Базовая технология"
                bindValue="id"
                [searchFn]="searchService"
                [(ngModel)]="Services" required
                (change)="onChange($event, service_data?.serv_id)">
                <ng-template ng-label-tmp let-item="item">
                  <span >{{item?.server?.dns_name  + ' + ' + item?.server_description +' + ' +  item?.server_id }}</span>
                </ng-template>
                <ng-template ng-option-tmp let-item="item" let-search="searchTerm" let-index="index">
                  <span >{{ item?.server?.dns_name + ' + ' + item?.server_description +' + ' +  item?.server_id }}</span>
                </ng-template> 
     </ng-select>
  </div>
  <div class="dropdown" >
    <label>Раздел массива</label>
    <ng-select  [items]="storage_partitions"
                placeholder="ДНС имя и точка доступа  массива"
                bindValue="id"
                 [searchFn]="searchStorage"
                [(ngModel)]="service_data.storage_partition_id"
                (change)="onChange($event, service_data?.Service)">
                <ng-template ng-label-tmp let-item="item">
                  <span >{{item?.storage?.dns_name  + ' ' + item?.server_mount_point }}</span>
                </ng-template>
                <ng-template ng-option-tmp let-item="item" let-search="searchTerm" let-index="index">
                  <span >{{ item?.storage?.dns_name + ' + ' + item?.server_mount_point }}</span>
                </ng-template> 
                
    </ng-select >
  </div>
    <div class="dropdown">
      <label>Раздел сервера</label>
      <ng-select  [items]="server_partitions"
                  placeholder="ДНС имя и точка доступа сервера"
                  bindValue="id"
                  [searchFn]="searchServer"
                  [(ngModel)]="service_data.server_partition_id"
                  (change)="onChange($event, service_data?.Service)"
                  >
                  <ng-template ng-label-tmp let-item="item">
                    <span >{{ item?.server?.dns_name + ' + ' + item?.server_mount_point }}</span>
                  </ng-template>
                    <ng-template ng-option-tmp let-item="item" let-search="searchTerm" let-index="index">
                      <span >{{ item?.server?.dns_name + ' + ' + item?.server_mount_point  }}</span>
                    </ng-template>
                    <ng-option> </ng-option>
      </ng-select>
    </div>
  <div class="p-field">
    <label>Путь</label>
    <input type="text" pInputText  [(ngModel)]="service_data.path" placeholder="текст" />
  </div>
  <div class="p-field">
    <label>Заметки</label>
    <input type="text" pInputText  [(ngModel)]="service_data.my_notes" placeholder="текст" />
  </div>
  <div class="row">
    <div class="col-6">
      <button pButton pRipple label="Save" icon="pi pi-check" class="p-button-text"
              [disabled]=" !submitted && !service_data.serv_id"
                           (click)="saveService_Data()"></button> 
    </div>
    <div class="col-6"> 
      <button pButton pRipple label="Cansel" icon="pi pi-cancel" class="p-button-text" (click)="hideDialog()"></button> 
    </div>
  </div>
</p-dialog>

<p-confirmDialog></p-confirmDialog>
